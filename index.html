<!-- index1.07.html â€” Full complete build (fixed modal) -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="hehehe.id - Stealth Secure Player" />
  <title>hehehe.id â€” index1.07</title>

  <!-- CSP: use meta for convenience; move to _headers for strict server-side enforcement -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; connect-src 'self' https:; frame-src https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline'; object-src 'none'; base-uri 'self'; frame-ancestors *;">

  <style>
    /* Basic layout + responsive improvements */
    :root{--bg:#fff;--text:#111;--muted:#6b6b6b;--accent:#1a73e8}
    [data-theme="dark"]{--bg:#0f1720;--text:#e8eef8;--muted:#9aa4b2}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif}

    .header{display:flex;flex-direction:column;align-items:center;gap:8px;padding:12px 18px;border-bottom:1px solid rgba(0,0,0,0.06)}
    .logo{font-weight:800;font-size:20px;text-decoration:none;color:inherit;text-align:center}
    .nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .nav a{padding:8px 12px;border-radius:8px;text-decoration:none;color:var(--text);border:1px solid rgba(0,0,0,0.06);background:transparent}

    /* standout ad button */
    #adsBtn{background:linear-gradient(45deg,#ff6b6b,#ffb86c);color:#fff;font-weight:700;border:none;padding:8px 14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.12)}

    .container{max-width:1100px;margin:20px auto;padding:0 14px}
    .video-frame{background:#000;border-radius:10px;min-height:320px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .loading{padding:36px;text-align:center;color:var(--muted)}
    .controls{display:flex;gap:10px;justify-content:center;margin-top:16px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer}
    .btn-next{background:linear-gradient(45deg,#FF6B6B,#4ECDC4);color:#fff}

    /* modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:9999}
    .modal{background:var(--bg);padding:20px;border-radius:10px;max-width:480px;width:92%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.2)}
    .modal h2{margin:0 0 8px}

    footer{padding:24px 12px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:640px){
      .logo{font-size:18px}
      .video-frame{min-height:220px}
      .nav a{padding:8px 10px;font-size:14px}
      #adsBtn{padding:8px 10px}
    }
  </style>
</head>
<body>

  <!-- HEADER: logo centered, nav below -->
  <header class="header">
    <a class="logo" href="/">hehehe.id</a>
    <nav class="nav" role="navigation" aria-label="Main navigation">
      <a href="/">Home</a>
      <a href="#play-eksib" id="navEksib">Eksib</a>
      <a href="#play-hijab" id="navHijab">Hijab</a>
      <a href="https://linkpasangiklan.com" id="adsBtn" target="_blank" rel="noopener">Pasang Iklan</a>
    </nav>
  </header>

  <!-- MODAL NOTICE (hidden by default) -->
  <div id="modalNotice" class="modal-overlay" style="display:none">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle">Dengan melanjutkan dosa ditanggung sendiri-sendiri</h2>
      <p id="modalDesc" style="min-height:18px;color:var(--muted)"></p>
      <div style="margin-top:12px;display:flex;gap:10px;justify-content:center">
        <button id="continueBtn" class="btn">Lanjutkan</button>
        <button id="confirmBtn" class="btn">Gass</button>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="container">
    <article id="videoBox" class="video-frame"><div class="loading">Memuat video...</div></article>

    <div class="controls">
      <button id="nextRandomBtn" class="btn btn-next">ðŸ”€ Video Acak Berikutnya</button>
    </div>
  </main>

  <footer>Â© <span id="year"></span> hehehe.id</footer>

<script>
(function(){ 'use strict';

  /* ========== CONFIG ========== */
  const HOMEPAGE = 'https://gist.githubusercontent.com/lihatlive01-sudo/5e3ba9c9392793aa815941cdec58459c/raw/2d4d8745d4246cb68f2f1dd64c05a8191f5be352/playlist.txt';
  const COLLECTIONS = {
    'eksib': 'https://gist.githubusercontent.com/lihatlive01-sudo/3aaa2daa010f96676a96e601ad194a86/raw/e7ffd6cfd7ce688c9a8bde0ab35862bdbb0ec6c5/halaman2.txt',
    'hijab': 'https://gist.githubusercontent.com/lihatlive01-sudo/869721f437c8b3e0ba6651625ff46a02/raw/3491bf0508a08630411d73abea3d456adb990b33/halaman1.txt'
  };

  // Smartlink & whitelist
  const SMARTLINK = 'https://www.effectivegatecpm.com/vsft88c6?key=2fad6f717c5d155f438ee18cb2aea5cf';
  const ALLOWED = new Set();
  function allowHost(url){ try{ const u = new URL(url); ALLOWED.add(u.hostname); const parts = u.hostname.split('.'); if(parts.length>2) ALLOWED.add(parts.slice(1).join('.')); }catch(e){} }
  allowHost(SMARTLINK);

  /* ========== UTILITIES ========== */
  function isHTTPS(u){ try{ return new URL(u).protocol === 'https:'; }catch{return false;} }
  function decodeB64(x){ try{ const d = atob(x); return /[<>]/.test(d) ? null : d; }catch{return null;} }

  function safeOpen(url){ try{ if(!isHTTPS(url)) return false; const host = new URL(url).hostname.toLowerCase(); if(!ALLOWED.has(host) && !Array.from(ALLOWED).some(h=>host.endsWith('.'+h))) return false; window.open(url,'_blank','noopener,noreferrer'); return true; }catch(e){return false;} }

  /* ========== FETCH + PARSE PLAYLIST ========== */
  async function fetchText(url){ try{ const r = await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error('network'); return await r.text(); }catch(e){ console.warn('fetch failed',url,e); return ''; } }

  function parsePlaylist(txt){ if(!txt) return []; const lines = txt.split('
').map(s=>s.trim()).filter(Boolean); const out = []; for(const line of lines){ const m = line.match(/<iframe[^>]*src=["']([^"']+)["'][^>]*>/i); if(m && isHTTPS(m[1])) out.push(m[1]); else if(isHTTPS(line)) out.push(line); } return [...new Set(out)]; }

  async function loadPlaylist(url){ const txt = await fetchText(url); const list = parsePlaylist(txt); list.forEach(allowHost); return list; }

  /* ========== RENDER SAFE ========== */
  const videoBox = document.getElementById('videoBox');

  function clearBox(){ videoBox.innerHTML = ''; }

  function renderUrl(url, playlist=[], category=null){ clearBox(); if(!isHTTPS(url)){ const m = document.createElement('div'); m.className='loading'; m.textContent='Video diblokir atau tidak valid'; videoBox.appendChild(m); return; }
    const wrap = document.createElement('div'); wrap.className='video-frame'; const ifr = document.createElement('iframe'); ifr.setAttribute('src', url); ifr.setAttribute('frameborder','0'); ifr.setAttribute('allow','accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'); ifr.setAttribute('allowfullscreen',''); ifr.style.width='100%'; ifr.style.height='100%'; wrap.appendChild(ifr); videoBox.appendChild(wrap);
    if(Array.isArray(playlist) && playlist.length) try{ sessionStorage.setItem('currentPlaylist', JSON.stringify(playlist)); if(category) sessionStorage.setItem('currentCategory', category); }catch(e){}
  }

  async function playRandomFrom(url){ const list = await loadPlaylist(url); if(list.length) renderUrl(list[Math.floor(Math.random()*list.length)], list); else { clearBox(); const m = document.createElement('div'); m.className='loading'; m.textContent='Tidak ada video tersedia'; videoBox.appendChild(m); } }

  async function playCategory(cat){ const url = COLLECTIONS[cat]; if(!url) return playRandomFrom(HOMEPAGE); const list = await loadPlaylist(url); if(list.length) renderUrl(list[Math.floor(Math.random()*list.length)], list, cat); else playRandomFrom(HOMEPAGE); }

  async function playHome(){ await playRandomFrom(HOMEPAGE); }

  function playNextFromSession(){ try{ const s = sessionStorage.getItem('currentPlaylist'); if(!s) return playHome(); const arr = JSON.parse(s); if(!Array.isArray(arr) || !arr.length) return playHome(); renderUrl(arr[Math.floor(Math.random()*arr.length)], arr); }catch(e){ playHome(); } }

  /* ========== MODAL BEHAVIOUR (FIXED) ========== */
  function openModal(){ // guard: if user already acknowledged, do not show (prevents Home clicks from triggering)
    try{ if(sessionStorage.getItem('noticeAck') === 'true') return; }catch(e){}
    const el = document.getElementById('modalNotice'); if(el) el.style.display = 'flex'; setTimeout(()=> safeOpen(SMARTLINK), 5000);
  }

  function closeModal(){ try{ const el=document.getElementById('modalNotice'); if(el) el.style.display='none'; sessionStorage.setItem('noticeAck','true'); }catch(e){} safeOpen(SMARTLINK); }

  /* recurring every 3 minutes regardless of acknowledgement status, but openModal itself checks noticeAck */
  setInterval(openModal, 180000);

  /* ========== HASHCHANGE listener so navigation updates without reload ========== */
  window.addEventListener('hashchange', function(){ const h = location.hash || ''; if(h.startsWith('#play-')){ const cat = h.replace('#play-',''); playCategory(cat); } });

  /* ========== INITIALIZE ========== */
  document.getElementById('year').textContent = new Date().getFullYear();

  // Theme toggle (persisted)
  (function(){ const root = document.documentElement; const s = localStorage.getItem('theme'); if(s) root.setAttribute('data-theme', s); const btn = document.getElementById('adsBtn'); /* adsBtn exists in header; used only for CTA, not theme */ })();

  document.addEventListener('DOMContentLoaded', async function(){
    // show modal only if not acknowledged (prevents F5 or clicking Home from re-showing)
    if(sessionStorage.getItem('noticeAck') !== 'true') openModal();

    const h = location.hash || '';
    if(h.startsWith('#play-')){ const cat = h.replace('#play-',''); await playCategory(cat); history.replaceState(null, null, ' '); }
    else if(h.startsWith('#dl=')){ const dec = decodeB64(h.slice(4)); if(dec && isHTTPS(dec)) renderUrl(dec); else await playHome(); history.replaceState(null,null,' '); }
    else await playHome();

    // Wire buttons
    document.getElementById('continueBtn').addEventListener('click', function(e){ e.preventDefault(); closeModal(); });
    document.getElementById('confirmBtn').addEventListener('click', function(e){ e.preventDefault(); closeModal(); });
    document.getElementById('nextRandomBtn').addEventListener('click', function(e){ e.preventDefault(); playNextFromSession(); });

    // nav buttons: ensure they trigger hashchange logic even on single-page navigation
    document.getElementById('navEksib').addEventListener('click', function(){ setTimeout(()=>{ const h = location.hash || ''; if(h.startsWith('#play-')){ const cat = h.replace('#play-',''); playCategory(cat); } }, 10); });
    document.getElementById('navHijab').addEventListener('click', function(){ setTimeout(()=>{ const h = location.hash || ''; if(h.startsWith('#play-')){ const cat = h.replace('#play-',''); playCategory(cat); } }, 10); });

  });

})();
</script>
</body>
</html>
